<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ravenclaw - Квест "Гнев Кернунна"</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sofia+Sans+Extra+Condensed:ital,wght@0,1..1000;1,1..1000&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Sofia Sans Extra Condensed", sans-serif;
            font-optical-sizing: auto;
            font-weight: 400;
            font-style: normal;
            background: url('https://radika1.link/2025/08/01/ra_forum_background_img_08c2550a6ef5a7985.jpg') center center fixed;
            background-size: auto;
            background-repeat: repeat;
            min-height: 100vh;
            color: #fff;
            font-size: 18px;
        }

        header {
            background: rgba(0, 0, 0, 0.8) url('https://radika1.link/2025/08/01/ra_forum_background_img_08c2550a6ef5a7985.jpg') center center;
            background-size: auto;
            background-repeat: repeat;
            border-bottom: 0px double #8A6A3E;
            padding: 30px 20px;
            text-align: center;
            position: relative;
        }

        header::before {
            display: none; 
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1;
        }

        header > * {
            position: relative;
            z-index: 2;
        }

        h1 {
            font-family: 'Permanent Marker', cursive;
            font-size: 3.5em;
            color: #8A6A3E;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.9);
            margin-bottom: 10px;
            letter-spacing: 3px;
        }

        .subtitle {
            font-family: "Sofia Sans Extra Condensed", sans-serif;
            color: #C9A86A;
            font-size: 1.8em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 15px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            background: rgba(21, 39, 63, 0.9);
            padding: 10px;
            border-radius: 8px;
            border: 2px double #8A6A3E;
        }

        button.tab-btn {
            padding: 12px 20px;
            background: #5D4C3A;
            color: #E8D8C0;
            border: 1px solid #8A6A3E;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 500;
            transition: all 0.3s;
            font-family: "Sofia Sans Extra Condensed", sans-serif;
        }

        button.tab-btn:hover {
            background: #6B5A48;
            transform: translateY(-2px);
        }

        button.tab-btn.active {
            background: #8A6A3E;
            color: #fff;
            border-color: #5D4C3A;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: rgba(21, 39, 63, 0.95);
            border: 2px double #8A6A3E;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .card.purple {
            border-color: #8A6A3E;
        }

        .card.green {
            border-color: #8A6A3E;
        }

        h2 {
            color: #C9A86A;
            margin-bottom: 15px;
            font-size: 1.8em;
            font-family: "Sofia Sans Extra Condensed", sans-serif;
            font-weight: 600;
        }

        .card.purple h2 {
            color: #C9A86A;
        }

        .card.green h2 {
            color: #C9A86A;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            background: rgba(21, 39, 63, 0.8);
            border: 1px solid #8A6A3E;
            border-radius: 5px;
            color: #fff;
            font-size: 1em;
            font-family: "Sofia Sans Extra Condensed", sans-serif;
        }

        input[type="text"]::placeholder,
        input[type="number"]::placeholder {
            color: #999;
        }

        button.add-btn {
            background: #5D4C3A;
            color: #E8D8C0;
            padding: 10px 20px;
            border: 1px solid #8A6A3E;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            margin-top: 10px;
            font-family: "Sofia Sans Extra Condensed", sans-serif;
            font-size: 1.1em;
        }

        button.add-btn:hover {
            background: #6B5A48;
            transform: scale(1.05);
        }

        button.delete-btn {
            background: #5D4C3A;
            color: #E8D8C0;
            padding: 6px 12px;
            border: 1px solid #8A6A3E;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
            font-family: "Sofia Sans Extra Condensed", sans-serif;
        }

        button.delete-btn:hover {
            background: #6B5A48;
        }

        .item-list {
            list-style: none;
        }

        .item-list li {
            background: rgba(21, 39, 63, 0.6);
            padding: 12px;
            margin: 8px 0;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 3px solid #8A6A3E;
        }

        .item-list li.purple-item {
            border-left-color: #8A6A3E;
        }

        .item-list li.green-item {
            border-left-color: #8A6A3E;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th {
            background: #15273F;
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid #8A6A3E;
            color: #C9A86A;
            font-weight: 600;
            font-family: "Sofia Sans Extra Condensed", sans-serif;
        }

        .card.green th {
            border-bottom-color: #8A6A3E;
            color: #C9A86A;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #8A6A3E;
            background: #15273F;
            font-family: "Sofia Sans Extra Condensed", sans-serif;
        }

        tr:hover {
            background: rgba(138, 106, 62, 0.2);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        .anger-display {
            background: rgba(21, 39, 63, 0.8);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #8A6A3E;
        }

        .anger-stat {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 1.05em;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .anger-stat:last-child {
            border-bottom: none;
        }

        .anger-stat span:last-child {
            font-weight: bold;
            color: #C9A86A;
        }

        .card.purple .anger-stat span:last-child {
            color: #C9A86A;
        }

        .card.green .anger-stat span:last-child {
            color: #C9A86A;
        }

        .anger-value {
            font-size: 1.3em !important;
            color: #B22222 !important;
        }

        .anger-value.high {
            color: #B22222 !important;
        }

        .anger-value.medium {
            color: #CD5C5C !important;
        }

        .anger-value.low {
            color: #6B8E23 !important;
        }

        .anger-bar {
            width: 100%;
            height: 30px;
            background: linear-gradient(90deg, #8B4513 0%, #A0522D 50%, #CD5C5C 100%);
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .anger-fill {
            height: 100%;
            background: linear-gradient(90deg, #556B2F 0%, #6B8E23 50%, #8FBC8F 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            position: absolute;
            right: 0;
        }

        .chart-container {
            background: rgba(21, 39, 63, 0.6);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #8A6A3E;
        }

        .chart-bar {
            display: flex;
            align-items: center;
            margin: 12px 0;
            gap: 10px;
        }

        .chart-label {
            min-width: 150px;
            text-align: right;
            font-size: 0.95em;
        }

        .chart-bar-visual {
            flex: 1;
            height: 25px;
            background: linear-gradient(90deg, #5D4C3A 0%, #8A6A3E 100%);
            border-radius: 5px;
            display: flex;
            align-items: center;
            padding-left: 10px;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }

        .chart-bar-visual.mercy {
            background: linear-gradient(90deg, #556B2F 0%, #6B8E23 100%);
        }

        .chart-bar-visual.anger {
            background: linear-gradient(90deg, #8B4513 0%, #CD5C5C 100%);
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }

        .status-badge {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-top: 10px;
            font-size: 0.95em;
        }

        .status-badge.rage {
            background: #B22222;
            color: white;
        }

        .status-badge.growing {
            background: #CD5C5C;
            color: white;
        }

        .status-badge.calming {
            background: #8A6A3E;
            color: white;
        }

        .status-badge.peaceful {
            background: #6B8E23;
            color: white;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .input-group input,
        .input-group select {
            margin: 0;
        }

        .input-group input {
            flex: 1;
        }

        .export-import-section {
            background: rgba(21, 39, 63, 0.8);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px double #8A6A3E;
        }

        .export-import-section button {
            margin: 5px;
        }

        #importFile {
            display: none;
        }

        .participant-view-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        #participantImageContainer {
            position: relative;
            width: 100%;
            max-width: 300px;
            background: transparent;
        }

        #participantImage {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 10px;
        }

        #participantAngerContainer {
            width: 100%;
            max-width: 600px;
        }

        .anger-bar-participant {
            width: 100%;
            height: 50px;
            background: linear-gradient(90deg, #8B4513 0%, #A0522D 35%, #CD5C5C 65%, #D2691E 100%);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 15px;
            position: relative;
            border: 2px solid #8A6A3E;
        }

        .mercy-fill-participant {
            height: 100%;
            background: linear-gradient(90deg, #556B2F 0%, #6B8E23 50%, #8FBC8F 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            left: 0;
        }

        .mercy-fill-participant span {
            color: white;
            font-weight: bold;
            font-size: 1.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            z-index: 10;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        .screenshot-btn {
            background: linear-gradient(135deg, #5D4C3A 0%, #8A6A3E 100%);
            color: #E8D8C0;
            padding: 12px 30px;
            border: 1px solid #8A6A3E;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            font-size: 1.1em;
            transition: all 0.3s;
            margin-top: 20px;
            font-family: "Sofia Sans Extra Condensed", sans-serif;
        }

        .screenshot-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(93, 76, 58, 0.6);
        }

        .anger-bar-participant {
            position: relative;
        }
    </style>
</head>
<body>
    <header>
        <h1>RAVENCLAW</h1>
        <p class="subtitle">Квест "Гнев Кернунна"</p>
    </header>

    <div class="container">
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('dashboard')">Dashboard</button>
            <button class="tab-btn" onclick="switchTab('participants')">Участники</button>
            <button class="tab-btn" onclick="switchTab('tasks')">Задания</button>
            <button class="tab-btn" onclick="switchTab('journal')">Журнал</button>
            <button class="tab-btn" style="margin-left: auto; background: #5a4a4a;" onclick="toggleExportImport()">Экспорт/Импорт</button>
        </div>

        <div id="exportImportPanel" class="export-import-section" style="display: none;">
            <h3 style="color: #C9A86A; margin-bottom: 15px;">Экспорт и импорт данных</h3>
            <button class="add-btn" onclick="exportData()">Экспортировать (JSON)</button>
            <button class="add-btn" onclick="document.getElementById('importFile').click()">Импортировать (JSON)</button>
            <input type="file" id="importFile" accept=".json" onchange="importData(event)">
            <p style="color: #aaa; margin-top: 10px; font-size: 0.9em;">Экспортируйте данные в файл JSON и импортируйте их на другом компьютере или браузере</p>
        </div>

        <div id="dashboard" class="tab-content active">
            <div class="dashboard-grid">
                <div class="card">
                    <h2>Вид ведущего (баллы)</h2>
                    <div class="anger-display">
                        <div class="anger-stat">
                            <span>Базовый гнев:</span>
                            <span id="baseAnger">50</span>
                        </div>
                        <div class="anger-stat">
                            <span>Количество участников:</span>
                            <span id="participantCount">0</span>
                        </div>
                        <div class="anger-stat">
                            <span>Гнев от участников (×20):</span>
                            <span id="participantAnger">0</span>
                        </div>
                        <div class="anger-stat">
                            <span>Гнев Кернунна:</span>
                            <span id="initialAnger" style="color: #B22222; font-size: 1.2em;">50</span>
                        </div>
                        <div style="border-top: 2px solid rgba(255, 255, 255, 0.2); margin: 10px 0;"></div>
                        <div class="anger-stat">
                            <span>Суммарная милость:</span>
                            <span id="totalMercy" style="color: #6B8E23;">0</span>
                        </div>
                        <div class="anger-stat">
                            <span>Оставшийся гнев:</span>
                            <span id="currentAnger" class="anger-value high">50</span>
                        </div>
                    </div>
                    <div class="anger-bar">
                        <div id="mercyFillLeader" class="anger-fill" style="width: 0%;">0 / 50</div>
                    </div>

                    <h3 style="margin-top: 20px; color: #C9A86A;">Диаграмма (баллы)</h3>
                    <div class="chart-container">
                        <div class="chart-bar">
                            <div class="chart-label">Базовый гнев</div>
                            <div class="chart-bar-visual anger" style="width: 150px;">50</div>
                        </div>
                        <div class="chart-bar">
                            <div class="chart-label">Гнев участников</div>
                            <div class="chart-bar-visual anger" id="chartParticipantAnger" style="width: 0px;">0</div>
                        </div>
                        <div class="chart-bar">
                            <div class="chart-label">Милость</div>
                            <div class="chart-bar-visual mercy" id="chartMercy" style="width: 0px;">0</div>
                        </div>
                        <div class="chart-bar" style="margin-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.2); padding-top: 15px;">
                            <div class="chart-label">Оставшийся гнев</div>
                            <div class="chart-bar-visual anger" id="chartCurrentAnger" style="width: 150px;">50</div>
                        </div>
                    </div>
                </div>

                <div class="card purple">
                    <h2>Вид участника (%)</h2>
                    <div class="participant-view-container">
                        <div id="participantImageContainer">
                            <img id="participantImage" src="https://s2.radikal.cloud/2025/10/15/Airbrush-BG-CHANGER-17604826441147118454f6a44b93d.png" alt="Божество">
                        </div>
                        <div id="participantAngerContainer">
                            <div class="anger-bar-participant">
                                <div id="mercyFillParticipant" class="mercy-fill-participant" style="width: 0%;">
                                    <span id="mercyPercent">0%</span>
                                </div>
                            </div>
                        </div>
                        <button class="screenshot-btn" onclick="captureAngerBar()">Сохранить шкалу как PNG</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="participants" class="tab-content">
            <div class="card purple">
                <h2>Список участников</h2>
                <div class="input-group">
                    <input type="text" id="newParticipantName" placeholder="Имя нового участника...">
                    <button class="add-btn" onclick="addParticipant()">Добавить</button>
                </div>
                <ul class="item-list" id="participantsList"></ul>
            </div>
        </div>

        <div id="tasks" class="tab-content">
            <div class="card">
                <h2>Список заданий</h2>
                <div class="grid-2">
                    <input type="text" id="newTaskName" placeholder="Название задания...">
                    <input type="number" id="newTaskMercy" placeholder="Очки милости..." min="1">
                </div>
                <button class="add-btn" onclick="addTask()">Добавить задание</button>
                <ul class="item-list" id="tasksList"></ul>
            </div>
        </div>

        <div id="journal" class="tab-content">
            <div class="card green">
                <h2>Журнал выполненных заданий</h2>
                <div class="grid-2">
                    <div>
                        <label style="font-size: 0.9em; color: #aaa;">Выберите участника:</label>
                        <select id="journalParticipant"></select>
                    </div>
                    <div>
                        <label style="font-size: 0.9em; color: #aaa;">Выберите задание:</label>
                        <select id="journalTask"></select>
                    </div>
                </div>
                <button class="add-btn" onclick="addJournalEntry()" style="background: #6B8E23;">Добавить запись</button>

                <table>
                    <thead>
                        <tr>
                            <th>Дата</th>
                            <th>Участник</th>
                            <th>Задание</th>
                            <th>Очки милости</th>
                            <th>Действие</th>
                        </tr>
                    </thead>
                    <tbody id="journalTable">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        function saveData() {
            const data = { participants, tasks, journal };
            localStorage.setItem('questData', JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem('questData');
            if (saved) {
                const data = JSON.parse(saved);
                participants = data.participants || participants;
                tasks = data.tasks || tasks;
                journal = data.journal || journal;
            }
        }

        function exportData() {
            const data = {
                participants,
                tasks,
                journal,
                exportDate: new Date().toLocaleString('ru-RU')
            };
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `quest_samaina_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            alert('Данные экспортированы!');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.participants && data.tasks && data.journal) {
                        participants = data.participants;
                        tasks = data.tasks;
                        journal = data.journal;
                        saveData();
                        renderParticipants();
                        renderTasks();
                        renderJournal();
                        alert('Данные импортированы успешно!');
                    } else {
                        alert('Неверный формат файла');
                    }
                } catch (error) {
                    alert('Ошибка при импорте: ' + error.message);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function toggleExportImport() {
            const panel = document.getElementById('exportImportPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        async function captureAngerBar() {
            const angerBarContainer = document.getElementById('participantAngerContainer');
            const angerBar = angerBarContainer.querySelector('.anger-bar-participant');
            const percent = document.getElementById('mercyPercent').textContent;
            
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Размеры шкалы
                const barWidth = 600;
                const barHeight = 80;
                const padding = 20;
                
                canvas.width = barWidth + padding * 2;
                canvas.height = barHeight + padding * 2;
                
                // Прозрачный фон
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Координаты шкалы
                const x = padding;
                const y = padding;
                
                // Градиент фона шкалы (гнев)
                const gradient = ctx.createLinearGradient(x, y, x + barWidth, y);
                gradient.addColorStop(0, '#8B4513');
                gradient.addColorStop(0.5, '#A0522D');
                gradient.addColorStop(1, '#CD5C5C');
                
                // Рисуем фоновую шкалу (гнев)
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.roundRect(x, y, barWidth, barHeight, 15);
                ctx.fill();
                
                // Рисуем заполняющую часть (милость)
                const percentValue = parseInt(percent);
                const fillWidth = (barWidth * percentValue) / 100;
                
                // Градиент милости
                const mercyGradient = ctx.createLinearGradient(x, y, x + barWidth, y);
                mercyGradient.addColorStop(0, '#556B2F');
                mercyGradient.addColorStop(0.5, '#6B8E23');
                mercyGradient.addColorStop(1, '#8FBC8F');
                
                ctx.fillStyle = mercyGradient;
                ctx.beginPath();
                ctx.roundRect(x, y, fillWidth, barHeight, 15);
                ctx.fill();
                
                // Рисуем текст с процентом
                ctx.fillStyle = 'white';
                ctx.font = 'bold 48px "Sofia Sans Extra Condensed"';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';
                ctx.shadowBlur = 6;
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
                ctx.fillText(percent, canvas.width / 2, canvas.height / 2);
                
                // Сохраняем как PNG
                canvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `anger_scale_${new Date().toISOString().split('T')[0]}.png`;
                    link.click();
                    URL.revokeObjectURL(url);
                    alert('Шкала сохранена как PNG!');
                }, 'image/png');
            } catch (error) {
                alert('Ошибка при сохранении: ' + error.message);
            }
        }

        function clearAllData() {
            if (confirm('Вы уверены? Все данные будут удалены навсегда!')) {
                localStorage.removeItem('questData');
                participants = [
                    { id: 1, name: 'Артем' },
                    { id: 2, name: 'Виктория' },
                    { id: 3, name: 'Максим' }
                ];
                tasks = [
                    { id: 1, name: 'Найти артефакт проклятия', mercy: 15 },
                    { id: 2, name: 'Решить загадку духа', mercy: 10 },
                    { id: 3, name: 'Помочь потерянной душе', mercy: 25 },
                    { id: 4, name: 'Расшифровать рунический текст', mercy: 20 }
                ];
                journal = [];
                renderParticipants();
                renderTasks();
                renderJournal();
                alert('Данные восстановлены к начальному состоянию');
            }
        }

        let participants = [
            { id: 1, name: 'Артем' },
            { id: 2, name: 'Виктория' },
            { id: 3, name: 'Максим' }
        ];

        let tasks = [
            { id: 1, name: 'Найти артефакт проклятия', mercy: 15 },
            { id: 2, name: 'Решить загадку духа', mercy: 10 },
            { id: 3, name: 'Помочь потерянной душе', mercy: 25 },
            { id: 4, name: 'Расшифровать рунический текст', mercy: 20 }
        ];

        let journal = [
            { id: 1, date: '2025-10-15', participantId: 1, taskId: 2, mercy: 10 },
            { id: 2, date: '2025-10-15', participantId: 2, taskId: 1, mercy: 15 }
        ];

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function updateDashboard() {
            const baseAnger = 50;
            const participantCount = participants.length;
            const participantAnger = participantCount * 20;
            const initialAnger = baseAnger + participantAnger;
            const totalMercy = journal.reduce((sum, entry) => sum + entry.mercy, 0);
            const currentAnger = Math.max(0, initialAnger - totalMercy);
            const mercyPercent = initialAnger === 0 ? 0 : Math.round((totalMercy / initialAnger) * 100);

            document.getElementById('baseAnger').textContent = baseAnger;
            document.getElementById('participantCount').textContent = participantCount;
            document.getElementById('participantAnger').textContent = participantAnger;
            document.getElementById('initialAnger').textContent = initialAnger;
            document.getElementById('totalMercy').textContent = totalMercy;
            document.getElementById('currentAnger').textContent = currentAnger;

            // Шкала ведущего: зеленая милость растет слева направо
            const mercyFillLeader = document.getElementById('mercyFillLeader');
            mercyFillLeader.style.width = mercyPercent + '%';
            mercyFillLeader.textContent = totalMercy + ' / ' + initialAnger;

            // Шкала участника: зеленая милость растет слева направо
            document.getElementById('mercyPercent').textContent = mercyPercent + '%';
            const mercyFillParticipant = document.getElementById('mercyFillParticipant');
            mercyFillParticipant.style.width = mercyPercent + '%';

            const angerValue = document.getElementById('currentAnger');
            angerValue.className = 'anger-value';
            if (currentAnger > initialAnger * 0.67) {
                angerValue.classList.add('high');
            } else if (currentAnger > initialAnger * 0.33) {
                angerValue.classList.add('medium');
            } else {
                angerValue.classList.add('low');
            }

            document.getElementById('chartParticipantAnger').style.width = (participantAnger / initialAnger * 300) + 'px';
            document.getElementById('chartParticipantAnger').textContent = participantAnger;
            document.getElementById('chartMercy').style.width = (totalMercy / initialAnger * 300) + 'px';
            document.getElementById('chartMercy').textContent = totalMercy;
            document.getElementById('chartCurrentAnger').style.width = (currentAnger / initialAnger * 300) + 'px';
            document.getElementById('chartCurrentAnger').textContent = currentAnger;
        }

        function renderParticipants() {
            const list = document.getElementById('participantsList');
            list.innerHTML = participants.map(p => `
                <li class="purple-item">
                    <span><strong>#${p.id}</strong> ${p.name}</span>
                    <button class="delete-btn" onclick="deleteParticipant(${p.id})">Удалить</button>
                </li>
            `).join('');

            updateParticipantSelect();
        }

        function renderTasks() {
            const list = document.getElementById('tasksList');
            list.innerHTML = tasks.map(t => `
                <li>
                    <span><strong>#${t.id}</strong> ${t.name} <span style="color: #6B8E23; margin-left: 10px;">Милость: +${t.mercy}</span></span>
                    <button class="delete-btn" onclick="deleteTask(${t.id})">Удалить</button>
                </li>
            `).join('');

            updateTaskSelect();
        }

        function renderJournal() {
            const table = document.getElementById('journalTable');
            table.innerHTML = journal.map(j => {
                const participant = participants.find(p => p.id === j.participantId);
                const task = tasks.find(t => t.id === j.taskId);
                return `
                    <tr>
                        <td>${j.date}</td>
                        <td>${participant ? participant.name : 'Неизвестно'}</td>
                        <td>${task ? task.name : 'Неизвестно'}</td>
                        <td style="text-align: center; color: #6B8E23;">+${j.mercy}</td>
                        <td style="text-align: center;">
                            <button class="delete-btn" onclick="deleteJournalEntry(${j.id})">Удалить</button>
                        </td>
                    </tr>
                `;
            }).join('');

            updateDashboard();
        }

        function updateParticipantSelect() {
            const select = document.getElementById('journalParticipant');
            select.innerHTML = '<option value="">Выберите участника...</option>' + 
                participants.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
        }

        function updateTaskSelect() {
            const select = document.getElementById('journalTask');
            select.innerHTML = '<option value="">Выберите задание...</option>' + 
                tasks.map(t => `<option value="${t.id}">${t.name} (+${t.mercy})</option>`).join('');
        }

        function addParticipant() {
            const name = document.getElementById('newParticipantName').value.trim();
            if (name) {
                const id = Math.max(...participants.map(p => p.id), 0) + 1;
                participants.push({ id, name });
                document.getElementById('newParticipantName').value = '';
                renderParticipants();
                updateDashboard();
                saveData();
            }
        }

        function deleteParticipant(id) {
            participants = participants.filter(p => p.id !== id);
            journal = journal.filter(j => j.participantId !== id);
            renderParticipants();
            renderJournal();
            saveData();
        }

        function addTask() {
            const name = document.getElementById('newTaskName').value.trim();
            const mercy = parseInt(document.getElementById('newTaskMercy').value) || 0;
            if (name && mercy > 0) {
                const id = Math.max(...tasks.map(t => t.id), 0) + 1;
                tasks.push({ id, name, mercy });
                document.getElementById('newTaskName').value = '';
                document.getElementById('newTaskMercy').value = '';
                renderTasks();
                saveData();
            }
        }

        function deleteTask(id) {
            tasks = tasks.filter(t => t.id !== id);
            renderTasks();
            saveData();
        }

        function addJournalEntry() {
            const participantId = parseInt(document.getElementById('journalParticipant').value);
            const taskId = parseInt(document.getElementById('journalTask').value);
            
            if (participantId && taskId) {
                const task = tasks.find(t => t.id === taskId);
                const id = Math.max(...journal.map(j => j.id), 0) + 1;
                const today = new Date().toISOString().split('T')[0];
                journal.push({
                    id,
                    date: today,
                    participantId,
                    taskId,
                    mercy: task.mercy
                });
                document.getElementById('journalParticipant').value = '';
                document.getElementById('journalTask').value = '';
                renderJournal();
                saveData();
            }
        }

        function deleteJournalEntry(id) {
            journal = journal.filter(j => j.id !== id);
            renderJournal();
            saveData();
        }

        window.addEventListener('load', () => {
            loadData();
            renderParticipants();
            renderTasks();
            renderJournal();
        });
    </script>
</body>
</html>
